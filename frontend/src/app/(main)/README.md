# Модуль основной логики `(main)`

## Назначение
Модуль отвечает за основной layout приложения, защищённые страницы (чаты, админка), интеграцию с аутентификацией и навигацией. Реализует защищённый роутинг и общий интерфейс для авторизованных пользователей.

## Структура
```
(main)/
├── layout.tsx        # Основной layout с header и sidebar
├── chat/             # Модуль чатов
│   ├── page.tsx      # Страница списка чатов
│   └── [id]/         # Динамические страницы чатов
│       └── page.tsx  # Страница детального просмотра чата
├── administration/   # Модуль администрации
│   └── page.tsx      # Страница административного интерфейса
└── README.md         # Документация модуля
```

### Связанные компоненты и логика:
- `widgets/header` — компонент верхней панели
- `widgets/sidebar` — боковая панель навигации
- `widgets/administration-tabs` — табы административного интерфейса
- `features/chat-box` — компонент чата с Socket.IO
- `shared/hooks/use-auth-guard` — хук для защиты роутов
- `features/chat` — функционал чатов
- `features/administration` — функционал администрирования

## Основные компоненты

### MainLayout
Основной layout приложения, который включает:
- Защиту роутов через `useAuthGuard`
- Верхнюю панель (`Header`)
- Боковую панель (`Sidebar`) с контекстом
- Адаптивную структуру с flexbox

### Chat Module
- **Список чатов** (`chat/page.tsx`):
  - Отображение всех доступных чатов
  - Навигация к конкретному чату
  - Интеграция с chat-store

- **Детальный чат** (`chat/[id]/page.tsx`):
  - Полноэкранный интерфейс чата
  - Real-time обновления через Socket.IO
  - История сообщений и отправка

### Administration Module
- **Админ-панель** (`administration/page.tsx`):
  - Табы для навигации по разделам
  - Управление пользователями
  - Настройки системы
  - Мониторинг и логи

## Особенности
- **Защита роутов:** все страницы защищены через `useAuthGuard`
- **Контекст Sidebar:** управление состоянием боковой панели
- **Адаптивность:** responsive design для всех компонентов
- **Socket.Io:** real-time обновления в чатах
- **State Management:** интеграция с Zustand для глобального состояния

## Пример использования
```tsx
// Внутри защищённой страницы
export default function ProtectedPage() {
  return (
    <div>
      {/* Контент страницы */}
    </div>
  )
}
```

## Best practices
- Все страницы автоматически защищены через `useAuthGuard`
- Используйте контекст Sidebar для управления состоянием боковой панели
- Следуйте принципам atomic design при создании компонентов
- Поддерживайте единый стиль для всех защищённых страниц
- Используйте Socket.IO для real-time функционала в чатах
- Разделяйте административный интерфейс на логические табы

## Новое (июнь 2025)

### 10.06
- Глубокий рефакторинг и документирование компонентов chat, sidebar, chat-list, create-chat-button, chat-actions-popover.
- Современный UI: плавные анимации, адаптивность, строгая типизация, докстринги по гайду.
- Вынесены все цвета и оттенки primary в CSS-переменные и Tailwind-конфиг, реализована динамическая смена тем.
- README для sidebar и chat-list обновлены: структура, примеры, best practices.
- Tailwind-конфиг и globals.css приведены к единому стилю, добавлены комментарии, удалены дубли.
- Исправлены баги с цветами, бордерами, анимациями, тултипами, адаптацией.
- Документация и код полностью соответствуют гайдлайнам проекта.

### 09.06
- Проведён рефакторинг структуры: директории `@/widgets/sidebar` и `@/widgets/administation-tabs` перенесены в `@/features/sidebar` и `@/features/administration`.
- Объединены и обновлены README.md для модулей sidebar и administration.
- Улучшена документация: добавлены докстринги, примеры использования, описания структуры.
- Обновлены импорты по всему проекту на новые пути.
- Приведён код к единому стилю согласно документационному гайду.

### 08.06
- Перенесён header из widgets в features/header, теперь используется только useAuthStore для профиля пользователя.
- Исправлено отображение имени, email и роли пользователя в header.
- Кнопка "Администрирование" теперь видна только для ADMIN.
- Добавлена документация и докстринги к компоненту Header.

### 07.06
- Исправлен баг некорректной регистрации и аутентификации новых пользователей
- Централизованная авторизация через useAuthGuard
- Хранение msw-users в localStorage
- Улучшен UX logout, убран ручной редирект
- Обновлены моки MSW для поддержки нескольких пользователей

### 04.06
- Меню управления чатом реализовано как отдельный Popover-компонент с улучшенным UX для архивирования/удаления
- Исправлены визуальные баги и сообщения тостов

---
_Документация актуальна для структуры на июнь 2025._ 